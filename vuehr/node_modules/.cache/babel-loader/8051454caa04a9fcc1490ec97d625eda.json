{"remainingRequest":"F:\\java-workspace\\vhr\\vuehr\\node_modules\\babel-loader\\lib\\index.js!F:\\java-workspace\\vhr\\vuehr\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\java-workspace\\vhr\\vuehr\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\java-workspace\\vhr\\vuehr\\src\\components\\sys\\basic\\DepMana.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\java-workspace\\vhr\\vuehr\\src\\components\\sys\\basic\\DepMana.vue","mtime":1602683695061},{"path":"F:\\java-workspace\\vhr\\vuehr\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\java-workspace\\vhr\\vuehr\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"F:\\java-workspace\\vhr\\vuehr\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\java-workspace\\vhr\\vuehr\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IHsgZ2V0UmVxdWVzdCB9IGZyb20gIkAvdXRpbHMvYXBpIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJEZXBNYW5hIiwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZGVwOiB7CiAgICAgICAgbmFtZTogJycsCiAgICAgICAgcGFyZW50SWQ6IC0xCiAgICAgIH0sCiAgICAgIHBuYW1lOiAnJywKICAgICAgZGlhbG9nVmlzaWJsZTogZmFsc2UsCiAgICAgIGZpbHRlclRleHQ6ICcnLAogICAgICBkZXBzOiBbXSwKICAgICAgZGVmYXVsdFByb3BzOiB7CiAgICAgICAgY2hpbGRyZW46ICdjaGlsZHJlbicsCiAgICAgICAgbGFiZWw6ICduYW1lJwogICAgICB9CiAgICB9OwogIH0sCiAgd2F0Y2g6IHsKICAgIGZpbHRlclRleHQ6IGZ1bmN0aW9uIGZpbHRlclRleHQodmFsKSB7CiAgICAgIHRoaXMuJHJlZnMudHJlZS5maWx0ZXIodmFsKTsKICAgIH0KICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICB0aGlzLmluaXREZXBzKCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBpbml0RGVwOiBmdW5jdGlvbiBpbml0RGVwKCkgewogICAgICB0aGlzLmRlcCA9IHsKICAgICAgICBuYW1lOiAnJywKICAgICAgICBwYXJlbnRJZDogLTEKICAgICAgfTsKICAgICAgdGhpcy5wbmFtZSA9ICcnOwogICAgfSwKICAgIGFkZERlcDJEZXBzOiBmdW5jdGlvbiBhZGREZXAyRGVwcyhkZXBzLCBkZXApIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGQgPSBkZXBzW2ldOwoKICAgICAgICBpZiAoZC5pZCA9PSBkZXAucGFyZW50SWQpIHsKICAgICAgICAgIGQuY2hpbGRyZW4gPSBkLmNoaWxkcmVuLmNvbmNhdChkZXApOwoKICAgICAgICAgIGlmIChkLmNoaWxkcmVuLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgZC5wYXJlbnQgPSB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5hZGREZXAyRGVwcyhkLmNoaWxkcmVuLCBkZXApOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGRvQWRkRGVwOiBmdW5jdGlvbiBkb0FkZERlcCgpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHRoaXMucG9zdFJlcXVlc3QoIi9zeXN0ZW0vYmFzaWMvZGVwYXJ0bWVudC8iLCB0aGlzLmRlcCkudGhlbihmdW5jdGlvbiAocmVzcCkgewogICAgICAgIGlmIChyZXNwKSB7CiAgICAgICAgICBfdGhpcy5hZGREZXAyRGVwcyhfdGhpcy5kZXBzLCByZXNwLm9iaik7CgogICAgICAgICAgX3RoaXMuZGlhbG9nVmlzaWJsZSA9IGZhbHNlOwoKICAgICAgICAgIF90aGlzLmluaXREZXAoKTsgLy/liJ3lp4vljJblj5jph48KCiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBzaG93QWRkRGVwVmlldzogZnVuY3Rpb24gc2hvd0FkZERlcFZpZXcoZGF0YSkgewogICAgICB0aGlzLnBuYW1lID0gZGF0YS5uYW1lOwogICAgICB0aGlzLmRlcC5wYXJlbnRJZCA9IGRhdGEuaWQ7CiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWU7CiAgICB9LAogICAgcmVtb3ZlRGVwRnJvbURlcHM6IGZ1bmN0aW9uIHJlbW92ZURlcEZyb21EZXBzKHAsIGRlcHMsIGlkKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGVwcy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBkID0gZGVwc1tpXTsKCiAgICAgICAgaWYgKGQuaWQgPT0gaWQpIHsKICAgICAgICAgIGRlcHMuc3BsaWNlKGksIDEpOwoKICAgICAgICAgIGlmIChkZXBzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgIHAucGFyZW50ID0gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnJlbW92ZURlcEZyb21EZXBzKGQsIGQuY2hpbGRyZW4sIGlkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBkZWxldGVEZXA6IGZ1bmN0aW9uIGRlbGV0ZURlcChkYXRhKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgaWYgKGRhdGEucGFyZW50KSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi54i26YOo6Zeo5Yig6Zmk5aSx6LSlIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy4kY29uZmlybSgn5q2k5pON5L2c5bCG5rC45LmF44CQJyArIGRhdGEubmFtZSArICfjgJHpg6jpl6gsIOaYr+WQpue7p+e7rT8nLCAn5o+Q56S6JywgewogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfnoa7lrponLAogICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogJ+WPlua2iCcsCiAgICAgICAgICB0eXBlOiAnd2FybmluZycKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzMi5kZWxldGVSZXF1ZXN0KCIvc3lzdGVtL2Jhc2ljL2RlcGFydG1lbnQvIiArIGRhdGEuaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICAgICAgaWYgKHJlc3ApIHsKICAgICAgICAgICAgICBfdGhpczIucmVtb3ZlRGVwRnJvbURlcHMobnVsbCwgX3RoaXMyLmRlcHMsIGRhdGEuaWQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczIuJG1lc3NhZ2UoewogICAgICAgICAgICB0eXBlOiAnaW5mbycsCiAgICAgICAgICAgIG1lc3NhZ2U6ICflt7Llj5bmtojliKDpmaQnCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGluaXREZXBzOiBmdW5jdGlvbiBpbml0RGVwcygpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB0aGlzLmdldFJlcXVlc3QoIi9zeXN0ZW0vYmFzaWMvZGVwYXJ0bWVudC8iKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7CiAgICAgICAgaWYgKHJlc3ApIHsKICAgICAgICAgIF90aGlzMy5kZXBzID0gcmVzcDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGZpbHRlck5vZGU6IGZ1bmN0aW9uIGZpbHRlck5vZGUodmFsdWUsIGRhdGEpIHsKICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuIHRydWU7CiAgICAgIHJldHVybiBkYXRhLm5hbWUuaW5kZXhPZih2YWx1ZSkgIT09IC0xOwogICAgfQogIH0KfTs="},{"version":3,"sources":["DepMana.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div style=\"width: 500px;\">\r\n    <el-input\r\n        placeholder=\"请输入部门名称进行搜索...\"\r\n        prefix-icon=\"el-icon-search\"\r\n        v-model=\"filterText\">\r\n    </el-input>\r\n\r\n    <el-tree\r\n        :data=\"deps\"\r\n        :props=\"defaultProps\"\r\n        :expand-on-click-node=\"false\"\r\n        :filter-node-method=\"filterNode\"\r\n        ref=\"tree\">\r\n      <span class=\"custom-tree-node\" slot-scope=\"{ node, data }\"\r\n            style=\"display: flex;justify-content: space-between;width: 100%;\">\r\n        <span>{{ data.name }}</span>\r\n        <span>\r\n          <el-button class=\"depBtn\"\r\n                     type=\"primary\"\r\n                     size=\"mini\"\r\n                     @click=\"() => showAddDepView(data)\">\r\n            添加部门\r\n          </el-button>\r\n          <el-button class=\"depBtn\"\r\n                     type=\"danger\"\r\n                     size=\"mini\"\r\n                     @click=\"() => deleteDep(data)\">\r\n            删除部门\r\n          </el-button>\r\n        </span>\r\n      </span>\r\n    </el-tree>\r\n    <el-dialog\r\n        title=\"添加部门\"\r\n        :visible.sync=\"dialogVisible\"\r\n        width=\"30%\">\r\n      <div>\r\n        <table>\r\n          <tr>\r\n            <td>\r\n              <el-tag>上级部门</el-tag>\r\n            </td>\r\n            <td>{{ pname }}</td>\r\n          </tr>\r\n          <tr>\r\n            <td>\r\n              <el-tag>部门名称</el-tag>\r\n            </td>\r\n            <td>\r\n              <el-input v-model=\"dep.name\" placeholder=\"请输入部门名称...\"></el-input>\r\n            </td>\r\n          </tr>\r\n        </table>\r\n      </div>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n    <el-button @click=\"dialogVisible = false\">取 消</el-button>\r\n    <el-button type=\"primary\" @click=\"doAddDep\">确 定</el-button>\r\n  </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {getRequest} from \"@/utils/api\";\r\n\r\nexport default {\r\n  name: \"DepMana\",\r\n  data() {\r\n    return {\r\n      dep: {\r\n        name: '',\r\n        parentId: -1,\r\n      },\r\n      pname: '',\r\n      dialogVisible: false,\r\n      filterText: '',\r\n      deps: [],\r\n      defaultProps: {\r\n        children: 'children',\r\n        label: 'name'\r\n      }\r\n    }\r\n  },\r\n  watch: {\r\n    filterText(val) {\r\n      this.$refs.tree.filter(val);\r\n    }\r\n  },\r\n  mounted() {\r\n    this.initDeps();\r\n  },\r\n  methods: {\r\n    initDep() {\r\n      this.dep = {\r\n        name: '',\r\n        parentId: -1,\r\n      }\r\n      this.pname = ''\r\n    },\r\n    addDep2Deps(deps, dep) {\r\n      for (let i = 0; i < deps.length; i++) {\r\n        let d = deps[i];\r\n        if (d.id == dep.parentId) {\r\n          d.children = d.children.concat(dep)\r\n          if(d.children.length>0){\r\n            d.parent=true\r\n          }\r\n          return;\r\n        } else {\r\n          this.addDep2Deps(d.children, dep)\r\n        }\r\n      }\r\n    },\r\n    doAddDep() {\r\n      this.postRequest(\"/system/basic/department/\", this.dep).then(resp => {\r\n        if (resp) {\r\n          this.addDep2Deps(this.deps, resp.obj)\r\n          this.dialogVisible = false\r\n          this.initDep();//初始化变量\r\n        }\r\n      })\r\n    },\r\n    showAddDepView(data) {\r\n      this.pname = data.name\r\n      this.dep.parentId = data.id;\r\n      this.dialogVisible = true;\r\n    },\r\n    removeDepFromDeps(p,deps, id) {\r\n      for (let i = 0; i < deps.length; i++) {\r\n        let d = deps[i];\r\n        if (d.id == id) {\r\n          deps.splice(i, 1);\r\n          if(deps.length==0){\r\n            p.parent=false\r\n          }\r\n          return;\r\n        } else {\r\n          this.removeDepFromDeps(d,d.children, id)\r\n        }\r\n      }\r\n    },\r\n    deleteDep(data) {\r\n      if (data.parent) {\r\n        this.$message.error(\"父部门删除失败\")\r\n      } else {\r\n        this.$confirm('此操作将永久【' + data.name + '】部门, 是否继续?', '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          this.deleteRequest(\"/system/basic/department/\" + data.id).then(resp => {\r\n            if (resp) {\r\n              this.removeDepFromDeps(null,this.deps, data.id)\r\n            }\r\n          })\r\n        }).catch(() => {\r\n          this.$message({\r\n            type: 'info',\r\n            message: '已取消删除'\r\n          });\r\n        });\r\n      }\r\n    },\r\n    initDeps() {\r\n      this.getRequest(\"/system/basic/department/\").then(resp => {\r\n        if (resp) {\r\n          this.deps = resp\r\n        }\r\n      })\r\n    },\r\n    filterNode(value, data) {\r\n      if (!value) return true;\r\n      return data.name.indexOf(value) !== -1;\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.depBtn {\r\n  padding: 2px;\r\n}\r\n</style>"],"sourceRoot":"src/components/sys/basic"}]}